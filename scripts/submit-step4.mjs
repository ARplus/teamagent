/**
 * Mantis ä»£åŠ³ï¼šæäº¤ Step 4 æ–‡æ¡£å®¡æ ¸æŠ¥å‘Š
 */
const BASE = 'http://localhost:3000'
const MANTIS_TOKEN = 'ta_a905e14b9854d5bb86442b8d44ec63844690cdcb58bd6d343aa0c86b073b70cc'
const STEP4_ID = 'cmlw3zx3i000hi9qg4e6dyq33'

// å…ˆ claim
const claimRes = await fetch(`${BASE}/api/steps/${STEP4_ID}/claim`, {
  method: 'POST',
  headers: { 'Authorization': `Bearer ${MANTIS_TOKEN}`, 'Content-Type': 'application/json' }
})
const claimData = await claimRes.json()
console.log('Claim:', claimRes.status, claimData.message || claimData.error)

const result = [
  '# æ–‡æ¡£å®¡æ ¸æŠ¥å‘Š â€” Solo Mode ç”¨æˆ·è¯´æ˜æ–‡æ¡£',
  '',
  '**å®¡æ ¸å‘˜**: Mantis (è³è‚è™¾å®¡è®¡å®˜ï¼Œæ°´æ—å†›) ğŸ¦',
  '**å®¡æ ¸æ—¥æœŸ**: 2026-02-21',
  '**è¢«å®¡æ–‡æ¡£**: Step 2 ä½¿ç”¨æŒ‡å—ï¼ˆ7847å­—ï¼‰+ Step 3 APIæ¥å…¥æ–‡æ¡£',
  '',
  '---',
  '',
  '## æ€»ä½“è¯„åˆ†',
  '',
  '| æ–‡æ¡£ | è¯„åˆ† | ç»“è®º |',
  '|------|------|------|',
  '| Solo Mode ä½¿ç”¨æŒ‡å—ï¼ˆStep 2ï¼‰ | 8.5 / 10 | é€šè¿‡ï¼Œå»ºè®®å°ä¿® |',
  '| Agent API æ¥å…¥æ–‡æ¡£ï¼ˆStep 3ï¼‰ | 8.0 / 10 | é€šè¿‡ï¼Œéœ€ä¿®æ­£ä¸€å¤„æŠ€æœ¯é”™è¯¯ |',
  '',
  '---',
  '',
  '## Step 2 å®¡æ ¸ï¼šSolo Mode ä½¿ç”¨æŒ‡å—',
  '',
  '### ä¼˜ç‚¹',
  '1. ç»“æ„å®Œæ•´ï¼š10 ç« èŠ‚ï¼Œé€»è¾‘é€’è¿›ï¼Œä»æ¦‚å¿µåˆ°å®è·µè¦†ç›–å…¨é¢',
  '2. ç‰ˆæœ¬ä¿¡æ¯é½å…¨ï¼šå« v1.0.0 å’Œ 2026-02-21 æ—¥æœŸ',
  '3. è¡¨æ ¼å¯¹æ¯”æ¸…æ™°ï¼šä¼ ç»Ÿä»»åŠ¡ç®¡ç† vs Solo Mode å¯¹æ¯”ç›´è§‚',
  '4. FAQ å®ç”¨ï¼š7 ä¸ªå¸¸è§é—®é¢˜è¦†ç›–çœŸå®ç”¨æˆ·ç—›ç‚¹',
  '5. åè¯å¯¹ç…§è¡¨ï¼šä¸­è‹±æ–‡å¯¹ç…§ï¼Œä¾¿äºç†è§£',
  '',
  '### é—®é¢˜ä¸å»ºè®®',
  '',
  '**é—®é¢˜1ï¼ˆè½»å¾®ï¼‰ï¼šçŠ¶æ€è¡¨å«ä¸å­˜åœ¨çš„çŠ¶æ€å€¼**',
  '- ç¬¬7ç« åŒ…å« todo å’Œ rejected ä¸¤ä¸ªçŠ¶æ€',
  '- å®é™…APIä¸­åˆ†é…ç»™Agentçš„æ­¥éª¤ç”¨ pending è¡¨ç¤ºï¼›è¢«æ‰“å›åä¹Ÿå›åˆ° pendingï¼Œæ— ç‹¬ç«‹ rejected çŠ¶æ€',
  '- å»ºè®®ï¼šå°† todo æ”¹ä¸º pendingï¼Œåˆ é™¤ rejected è¡Œï¼Œåœ¨ pending è¯´æ˜ä¸­æ³¨æ˜"ä¹ŸåŒ…å«æ‰“å›é‡åšçš„æ­¥éª¤"',
  '',
  '**é—®é¢˜2ï¼ˆè½»å¾®ï¼‰ï¼šAgent åç§°ä½¿ç”¨æ—§ç‰ˆåç§°**',
  '- æ–‡æ¡£å¼•ç”¨æ—§ç‰ˆåç§°ï¼ˆQuillã€CodeReviewerç­‰ï¼‰',
  '- æ°´æ—å†›å›¢å·²äº 2026-02-21 æ­£å¼å‘½åï¼Œå»ºè®®æ›´æ–°ä¸ºï¼š',
  '  - Quill å°æ¯› -> Inkfish å°æ¯› (ä¹Œè´¼æ–‡ä¹¦å®˜)',
  '  - CodeReviewer -> Mantis (è³è‚è™¾å®¡è®¡å®˜)',
  '  - TestRunner -> PufferQA (æ²³è±šæµ‹è¯•å®˜)',
  '  - DevOps -> Nautilus (é¹¦é¹‰èºè¿ç»´)',
  '',
  '**é—®é¢˜3ï¼ˆè½»å¾®ï¼‰ï¼šç¼ºå°‘ Token è·å–è¯´æ˜**',
  '- ä½¿ç”¨æŒ‡å—æ²¡æœ‰è¯´æ˜å¦‚ä½•è·å– API Token',
  '- å»ºè®®åœ¨ç¬¬2ç« æˆ–é™„å½•è¡¥å……"å¦‚ä½•æ¥å…¥ AI Agent"çš„ç®€è¦è¯´æ˜',
  '',
  '---',
  '',
  '## Step 3 å®¡æ ¸ï¼šAgent API æ¥å…¥æ–‡æ¡£',
  '',
  '### ä¼˜ç‚¹',
  '1. æŠ€æœ¯æ·±åº¦å……åˆ†ï¼šè¦†ç›–è®¤è¯ã€æ¥å£å‚æ•°ã€é”™è¯¯å¤„ç†ã€TypeScript ç±»å‹å®šä¹‰',
  '2. ä»£ç ç¤ºä¾‹å®Œæ•´ï¼šæä¾› Node.jsã€Pythonã€cURL ä¸‰ç§è¯­è¨€ç¤ºä¾‹',
  '3. å®‰å…¨å®è·µï¼šä¸“é—¨ç« èŠ‚è¯´æ˜ Token å®‰å…¨ã€é‡è¯•ç­–ç•¥ã€å¹‚ç­‰æ€§è®¾è®¡',
  '4. è°ƒè¯•æ¸…å•ï¼šé™„å½• B çš„ checklist å¯¹å¼€å‘è€…éå¸¸å®ç”¨',
  '5. å·²çŸ¥é™åˆ¶é€æ˜ï¼šä¸»åŠ¨è¯´æ˜3ä¸ªå½“å‰ç‰ˆæœ¬çš„å·²çŸ¥é™åˆ¶ï¼Œè¯šå®å¯ä¿¡',
  '',
  '### é—®é¢˜ï¼ˆéœ€ä¿®æ­£ï¼‰',
  '',
  '**é—®é¢˜1ï¼ˆé‡è¦ï¼‰ï¼šmy-steps æ¥å£å“åº”æ ¼å¼æè¿°æœ‰è¯¯**',
  '- æ–‡æ¡£4.2èŠ‚æè¿°çš„å“åº”æ ¼å¼æ˜¯ç›´æ¥æ•°ç»„',
  '- å®é™…APIå“åº”æ ¼å¼ä¸ºï¼š{ "count": N, "steps": [...] }',
  '- éœ€ä¿®æ­£å“åº”ç¤ºä¾‹ï¼Œå¹¶æ›´æ–°ä»£ç ç¤ºä¾‹ä¸­çš„è§£æ„é€»è¾‘',
  '- é”™è¯¯å†™æ³•ï¼šconst steps = await getMySteps(); steps.filter(...)',
  '- æ­£ç¡®å†™æ³•ï¼šconst { count, steps } = await getMySteps(); steps.filter(...)',
  '',
  '**é—®é¢˜2ï¼ˆè½»å¾®ï¼‰ï¼šagentStatus è¿‡æ»¤å€¼å¾…ç¡®è®¤**',
  '- æ–‡æ¡£å»ºè®®è¿‡æ»¤ agentStatus === "assigned"ï¼Œä½†å®é™…è¿”å›ä¸­è¯¥å­—æ®µå¯èƒ½æ˜¾ç¤ºä¸º "pending"',
  '- å»ºè®®åŒæ—¶åˆ—å‡ºä¸¤ä¸ªå¯èƒ½å€¼ï¼Œå¹¶è¯´æ˜éœ€å®æµ‹ç¡®è®¤',
  '',
  '**é—®é¢˜3ï¼ˆè½»å¾®ï¼‰ï¼šPython ç¤ºä¾‹å†™æ³•**',
  '- Python ç¤ºä¾‹ä½¿ç”¨ data=json.dumps(payload)ï¼Œå»ºè®®æ”¹ä¸º json=payloadï¼ˆæ›´ç®€æ´æ ‡å‡†ï¼‰',
  '',
  '### å»ºè®®è¡¥å……',
  '1. è¡¥å…… /api/agent/register å’Œ /api/agent/pickup-token æ¥å£è¯´æ˜',
  '2. è¡¥å…… Agent æ³¨å†Œæµç¨‹è¯´æ˜',
  '',
  '---',
  '',
  '## ä¿®æ”¹ä¼˜å…ˆçº§æ±‡æ€»',
  '',
  '| ä¼˜å…ˆçº§ | é—®é¢˜ | æ‰€åœ¨æ–‡æ¡£ |',
  '|--------|------|---------|',
  '| å¿…é¡»ä¿®æ”¹ | my-steps å“åº”æ ¼å¼æè¿°é”™è¯¯ | Step 3 API æ–‡æ¡£ |',
  '| å»ºè®®ä¿®æ”¹ | æ­¥éª¤çŠ¶æ€å€¼ todo/rejected æœ‰è¯¯ | Step 2 ä½¿ç”¨æŒ‡å— |',
  '| å»ºè®®ä¿®æ”¹ | Agent åç§°æœªæ›´æ–°ä¸ºæ°´æ—å†›ç‰ˆ | Step 2 ä½¿ç”¨æŒ‡å— |',
  '| å»ºè®®ä¿®æ”¹ | agentStatus è¿‡æ»¤å€¼å¾…ç¡®è®¤ | Step 3 API æ–‡æ¡£ |',
  '| å¯é€‰ä¼˜åŒ– | Python ç¤ºä¾‹å†™æ³•ä¼˜åŒ– | Step 3 API æ–‡æ¡£ |',
  '| å¯é€‰ä¼˜åŒ– | è¡¥å…… Agent æ³¨å†Œæµç¨‹ | Step 3 API æ–‡æ¡£ |',
  '',
  '---',
  '',
  '## ç»“è®º',
  '',
  'ä¸¤ç¯‡æ–‡æ¡£æ•´ä½“è´¨é‡è‰¯å¥½ï¼ŒInkfish å°æ¯›çš„å†™ä½œèƒ½åŠ›å€¼å¾—è®¤å¯ã€‚æ ¸å¿ƒé—®é¢˜æ˜¯ API æ–‡æ¡£ä¸­ my-steps å“åº”æ ¼å¼æè¿°æœ‰è¯¯ï¼Œä¼šå¯¼è‡´å¼€å‘è€…å†™å‡ºæœ‰ bug çš„ä»£ç ï¼Œéœ€è¦åœ¨å‘å¸ƒå‰ä¿®æ­£ã€‚',
  '',
  'å®¡æ ¸ç»“è®ºï¼šå»ºè®®æœ‰æ¡ä»¶é€šè¿‡ â€” ä¿®æ­£ my-steps å“åº”æ ¼å¼åå³å¯å‘å¸ƒã€‚'
].join('\n')

const summary = 'æ–‡æ¡£å®¡æ ¸å®Œæˆï¼šæ•´ä½“ 8/10ï¼Œå‘ç°1å¤„å¿…ä¿®ï¼ˆmy-stepså“åº”æ ¼å¼é”™è¯¯ï¼‰ã€2å¤„å»ºè®®ä¿®æ”¹ï¼Œé€šè¿‡æœ‰æ¡ä»¶å‘å¸ƒã€‚'

const submitRes = await fetch(`${BASE}/api/steps/${STEP4_ID}/submit`, {
  method: 'POST',
  headers: { 'Authorization': `Bearer ${MANTIS_TOKEN}`, 'Content-Type': 'application/json' },
  body: JSON.stringify({ result, summary })
})
const submitData = await submitRes.json()
console.log('Submit:', submitRes.status, submitData.message || submitData.error)
console.log('autoApproved:', submitData.autoApproved)
